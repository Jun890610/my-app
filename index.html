<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>í™ì½© ê°€ì¡±ì—¬í–‰</title>

<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />

<style>

  :root{
    --bg:#f5f6f8;
    --card:#ffffff;
    --text:#111;
    --muted:#666;
    --line:#e7e7e7;

    /* ê³µí†µ(ì»´í¬ë„ŒíŠ¸) */
    --radius:16px;
    --shadow:0 10px 30px rgba(0,0,0,.06);
    --shadow-soft:0 6px 18px rgba(0,0,0,.05);

    /* ê¸°ë³¸(í™ì½©) ì»¬ëŸ¬ */
    --accent:#0b0b0b;
    --accent-2:#111;
    --brand:#ff2d55;     /* ë„¤ì˜¨ í•‘í¬ */
    --brand-2:#00e5ff;   /* ë„¤ì˜¨ ì‹œì•ˆ */

    /* ë°°ê²½/í—¤ë” */
    --header-grad:linear-gradient(90deg,#060607 0%, #0b0b10 35%, #050506 100%);
    --header-glow:radial-gradient(600px 220px at 18% 20%, rgba(255,45,85,.18), transparent 70%),
                  radial-gradient(520px 220px at 82% 35%, rgba(0,229,255,.16), transparent 70%);
    --body-grad:radial-gradient(900px 520px at 15% 12%, rgba(255,45,85,.09), transparent 70%),
               radial-gradient(900px 520px at 85% 12%, rgba(0,229,255,.08), transparent 70%);
  }

  /* 2/16 ë””ì¦ˆë‹ˆ í…Œë§ˆ(ìë™ ì ìš©) */
  :root[data-theme="disney"]{
    --bg:#fff7fb;
    --card:#ffffff;
    --text:#151515;
    --muted:#6a5a64;
    --line:#f0dfe8;

    --brand:#ff4fa3;   /* í•‘í¬ */
    --brand-2:#7a5cff; /* ë³´ë¼ */

    --header-grad:linear-gradient(90deg,#1b0a2a 0%, #2a0b1c 45%, #130a2a 100%);
    --header-glow:radial-gradient(620px 240px at 20% 30%, rgba(255,79,163,.22), transparent 70%),
                  radial-gradient(620px 240px at 78% 35%, rgba(122,92,255,.20), transparent 70%);
    --body-grad:radial-gradient(900px 520px at 18% 10%, rgba(255,79,163,.12), transparent 70%),
               radial-gradient(900px 520px at 82% 10%, rgba(122,92,255,.11), transparent 70%);
  }

body{
    margin:0;
    font-family:-apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", sans-serif;
    background:var(--bg);
    background-image:var(--body-grad);
    background-attachment:fixed;
    color:var(--text);
  }
  header{
    background:var(--accent);
    background-image:var(--header-grad), var(--header-glow);
    background-size:cover;
    color:#fff;
    padding:18px 16px 22px;
  padding-right:280px;
    text-align:center;
    font-weight:800;
    letter-spacing:-0.2px;
    min-height:84px;
}
  header .sub{
    font-weight:600;
    opacity:.85;
    font-size:12px;
    margin-top:6px;
  }

  .tabs{
    display:flex;
    background:#fff;
    border-bottom:1px solid #ddd;
    position:sticky;
    top:0;
    z-index:10;
    overflow:auto;
  }
  .tabs button{
    flex:1;
    min-width:90px;
    padding:12px 10px;
    border:none;
    background:none;
    font-size:14px;
    cursor:pointer;
    white-space:nowrap;
  }
  .tabs button.active{
    border-bottom:3px solid #111;
    font-weight:800;
  }

  .wrap{ padding:14px; max-width:920px; margin:0 auto; }
  .toolbar{
    display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    padding:10px 0; margin:2px 0 12px;
  }
  .edit-toggle{
    display:flex; gap:8px; align-items:center; cursor:pointer; user-select:none;
    background:#fff; border:1px solid var(--line); border-radius:999px;
    padding:8px 12px;
  }
  .btn{
    padding:8px 12px; border-radius:10px; border:1px solid #ddd;
    background:#111; color:#fff; cursor:pointer;
  }
  .btn:disabled{ opacity:.4; cursor:not-allowed; }
  .btn-ghost{ background:#fff; color:#111; }

  .card{
    background:var(--card);
    border-radius:14px;
    padding:12px;
    margin:12px 0;
    border:1px solid #eee;
  }
  .card-header{
    display:flex;
    justify-content:space-between;
    gap:10px;
    align-items:flex-start;
    min-height:84px;
}
  .time{ font-weight:900; margin-bottom:6px; }
  .title{ font-weight:800; margin-top:2px; }
  .tag{
    font-size:12px;
    padding:4px 8px;
    border-radius:999px;
    border:1px solid #eee;
    color:#333;
    background:#fafafa;
    flex:0 0 auto;
  }
  .meta{
    color:var(--muted);
    font-size:13px;
    margin-top:6px;
    line-height:1.45;
  }
  .map-btn{
    display:inline-block;
    margin-top:10px;
    padding:9px 12px;
    border-radius:12px;
    background:#111;
    color:#fff;
    text-decoration:none;
    font-size:13px;
  }

  /* í¸ì§‘ í¼ */
  .edit-row{ margin-top:10px; display:flex; gap:8px; flex-wrap:wrap; }
  .edit-row input, .edit-row textarea, .edit-row select{
    width:100%; padding:10px; border-radius:10px; border:1px solid #ddd;
    font-size:14px;
    background:#fff;
  }
  .edit-actions{ display:flex; gap:8px; margin-top:10px; }
  .small-btn{ padding:8px 10px; border-radius:10px; border:1px solid #ddd; background:#fff; cursor:pointer; }
  .small-btn.danger{ border-color:#ffb3b3; color:#b30000; }
  .grid2{ display:grid; grid-template-columns:1fr 1fr; gap:8px; width:100%; }
  @media (max-width:720px){ .grid2{ grid-template-columns:1fr; } }

  /* ì •ë³´ ì„¹ì…˜ */
  details{
    background:#fff;
    border:1px solid #eee;
    border-radius:14px;
    padding:10px 12px;
    margin:12px 0;
  }
  summary{
    cursor:pointer;
    font-weight:800;
    list-style:none;
  }
  summary::-webkit-details-marker{ display:none; }
  .info{
    margin-top:10px;
    color:#333;
    line-height:1.55;
    font-size:14px;
  }
  .info ul{ margin:8px 0 0 18px; }
  .pill{
    display:inline-block;
    font-size:12px;
    padding:4px 8px;
    border-radius:999px;
    border:1px solid #eee;
    background:#fafafa;
    margin-left:8px;
    color:#444;
  }


/* ===== Header weather (right) ===== */
header.topbar{
  position: relative;
  text-align: center;
  padding-right: 220px; /* ìš°ì¸¡ ë‚ ì”¨ ì˜ì—­ ê³µê°„ í™•ë³´ */
}
.topbar-title{ display: inline-block; }
.header-weather{
  position: absolute;
  right: 18px;
  top: 12px;
  text-align: right;
  font-size: 12px;
  line-height: 1.25;
  color: #fff;
  opacity: .95;
}
.header-weather .current{
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 6px;
  font-weight: 800;
  font-size: 14px;
}
.header-weather .current .loc{
  font-weight: 700;
  opacity: .9;
  font-size: 12px;
}
.header-weather .daily{
  margin-top: 4px;
  display: grid;
  gap: 2px;
}
.header-weather .row{
  display: grid;
  grid-template-columns: auto 1fr auto;
  gap: 6px;
  align-items: center;
}
.header-weather .row .date{ opacity: .9; }
.header-weather .row .range{ opacity: .95; }
.header-weather .row .pop{ opacity: .85; }
@media (max-width: 920px){
  header.topbar{ padding-right: 18px; }
  .header-weather{
    position: static;
    margin-top: 8px;
    color: #fff;
    text-align: center;
  }
  .header-weather .current{ justify-content: center; }
  .header-weather .row{ justify-content: center; grid-template-columns: auto auto auto; }
}


/* === ì£¼ë³€ì •ë³´(í˜¸í…”) ë²„íŠ¼ UI === */
.muted{color:#777;font-size:13px;line-height:1.4}
.hotelBlock{margin-top:12px;padding:12px;border:1px solid rgba(0,0,0,.08);border-radius:14px;background:#fafafa}
.hotelName{font-weight:800;margin-bottom:8px}
.btnRow{display:flex;flex-wrap:wrap;gap:8px}
.btn.small{padding:8px 10px;font-size:13px;border-radius:12px}


/* ===== í•„ìˆ˜ì •ë³´(Info) íƒ­ ìŠ¤íƒ€ì¼ ===== */
.info-wrap { padding: 18px 0 6px; }
.info-grid { display: grid; grid-template-columns: 1fr; gap: 14px; }
.info-card {
  background: #fff;
  border: 1px solid rgba(0,0,0,0.06);
  border-radius: 14px;
  padding: 14px 14px 12px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.04);
}
.info-card h3 { margin: 0 0 10px; font-size: 16px; }
.info-list { margin: 0; padding-left: 18px; }
.info-list li { margin: 8px 0; line-height: 1.45; }
.info-actions { display: flex; flex-wrap: wrap; gap: 8px; margin: 8px 0 4px; }
.btn.small { padding: 8px 10px; border-radius: 999px; font-size: 13px; }
.muted { color: rgba(0,0,0,0.60); font-size: 13px; }


  body{
    background: var(--bg);
    background-image: var(--body-grad);
    color: var(--text);
  }

  header{
    background: var(--header-grad);
    position: sticky;
    top:0;
    z-index: 20;
    overflow:hidden;
  }
  header::before{
    content:"";
    position:absolute;
    inset:0;
    background: var(--header-glow);
    pointer-events:none;
  }

  .day-tab.active{
    border-color: rgba(255,255,255,.65);
    box-shadow: 0 10px 26px rgba(0,0,0,.18);
  }

  .chip{
    background: color-mix(in oklab, var(--brand) 8%, #fff);
    border: 1px solid color-mix(in oklab, var(--brand) 18%, #fff);
  }
  .chip .emoji{ filter: drop-shadow(0 1px 0 rgba(0,0,0,.12)); }

  .card{
    border:1px solid var(--line);
    box-shadow: var(--shadow-soft);
    border-radius: var(--radius);
  }

  .btn-primary{
    background: linear-gradient(135deg, var(--brand), var(--brand-2));
    border: none;
    box-shadow: 0 10px 26px rgba(0,0,0,.18);
  }
  .btn-primary:hover{ transform: translateY(-1px); }

  .map-btn{
    background: linear-gradient(135deg, var(--brand), var(--brand-2));
  }

  /* ë””ì¦ˆë‹ˆ ë‚ (2/16)ì—ëŠ” ì¹´ë“œì— ì€ì€í•œ ë°˜ì§ì´ ëŠë‚Œ */
  :root[data-theme="disney"] .card{
    background-image:
      radial-gradient(12px 12px at 10% 18%, rgba(255,255,255,.65), transparent 70%),
      radial-gradient(10px 10px at 82% 22%, rgba(255,255,255,.55), transparent 70%),
      radial-gradient(14px 14px at 35% 75%, rgba(255,255,255,.45), transparent 70%);
    background-blend-mode: screen;
  }

</style>
</head>

<body>
<header class="topbar">
  <div class="topbar-title">
    ğŸ‡­ğŸ‡° í™ì½© ê°€ì¡±ì—¬í–‰ ì›¹ì•±
    <div class="sub">2/15â€“2/17 Â· ë¶€ë¶€+ì•„ì´ Â· ìœ ëª¨ì°¨/íœ´ì‹ ë™ì„ </div>
  </div>
  <div id="headerWeather" class="header-weather" aria-label="ë‚ ì”¨"></div>
</header>

<div class="tabs" id="tabs"></div>

<div class="wrap">
  <!-- âœ… í¸ì§‘ ëª¨ë“œ íˆ´ë°” -->
  

  <!-- âœ… ì½˜í…ì¸  -->
  <div id="contentRoot"></div>

<div id="toolbar" class="toolbar">
    <label class="edit-toggle">
      <input type="checkbox" id="editModeToggle" />
      <span>ìŠ¤ì¼€ì¤„ í¸ì§‘ ëª¨ë“œ</span>
    </label>

    <button id="addItemBtn" class="btn" disabled>+ ì¼ì • ì¶”ê°€</button>
    <button id="resetBtn" class="btn btn-ghost" disabled>ì´ˆê¸°í™”</button>

    <button id="exportBtn" class="btn btn-ghost">ë‚´ë³´ë‚´ê¸°</button>
</div>

</div>

<script>
/** =========================
 *  0) ë°ì´í„°(ì´ˆê¸°ê°’)
 *  ========================= */
const DEFAULT_DATA = {
  "2/15": [
    {
      id: crypto.randomUUID(),
      time: "13:30â€“14:30",
      title: "í™ì½© ë„ì°© Â· ì…êµ­ Â· ìˆ˜í•˜ë¬¼ ìˆ˜ë ¹",
      tag: "ë„ì°©",
      transport: "none",
      from: "",
      to: "",
      notes: "eSIM ì¼œê¸°/ë°ì´í„° í™•ì¸ Â· ê³µí•­ ATM ì†Œì•¡ ì¸ì¶œ(HKD) Â· ì˜¥í† í¼ìŠ¤ ì¤€ë¹„"
    },
    {
      id: crypto.randomUUID(),
      time: "14:30â€“15:30",
      title: "ê³µí•­ â†’ ë¦¬ì¸ ì¹¼íŠ¼ í™ì½©(ICC) ì´ë™",
      tag: "ì´ë™",
      transport: "driving",
      from: "Hong Kong International Airport",
      to: "The Ritz-Carlton, Hong Kong",
      notes: "ì•„ì´ ì»¨ë””ì…˜/ì§ ê³ ë ¤í•´ íƒì‹œ ì¶”ì²œ Â· ì²´í¬ì¸ ì „ ì§ ë³´ê´€ ê°€ëŠ¥"
    },
    {
      id: crypto.randomUUID(),
      time: "15:30â€“16:45",
      title: "í˜¸í…” íœ´ì‹/ì•„ì´ ë‚®ì ",
      tag: "ë‚®ì ",
      transport: "none",
      from: "",
      to: "",
      notes: "ì €ë… ì¼ì • ëŒ€ë¹„ ì²´ë ¥ íšŒë³µ(ì¤‘ìš”)"
    },
    {
      id: crypto.randomUUID(),
      time: "17:00â€“18:00",
      title: "Makâ€™s Noodle (ì™„íƒ•ë©´/ì£½ë¥˜ Â· ë¶€ë‹´ ì ê²Œ)",
      tag: "ì‹ì‚¬",
      transport: "walking",
      from: "The Ritz-Carlton, Hong Kong",
      to: "Mak's Noodle, Tsim Sha Tsui",
      notes: "ë„ë³´ ì´ë™ Â· ê²°ì œ: ì¹´ë“œ/í˜„ê¸ˆ"
    },
    {
      id: crypto.randomUUID(),
      time: "18:15â€“19:00",
      title: "Avenue of Stars í•´ë³€ ì‚°ì±… (ìœ ëª¨ì°¨ OK)",
      tag: "ì‚°ì±…",
      transport: "walking",
      from: "Mak's Noodle, Tsim Sha Tsui",
      to: "Avenue of Stars, Tsim Sha Tsui",
      notes: "ë°”ëŒ/ê¸°ì˜¨ ëŒ€ë¹„ ê²‰ì˜·"
    },
    {
      id: crypto.randomUUID(),
      time: "19:00â€“19:30",
      title: "Star Ferry (ì§§ê³  ì¬ë¯¸ìˆëŠ” ì•¼ê²½ ì²´í—˜)",
      tag: "í˜ë¦¬",
      transport: "walking",
      from: "Star Ferry Pier, Tsim Sha Tsui",
      to: "Star Ferry Pier, Central",
      notes: "ê²°ì œ: ì˜¥í† í¼ìŠ¤/í˜„ê¸ˆ Â· ì•„ì´ê°€ ì¢‹ì•„í•¨"
    },
    {
      id: crypto.randomUUID(),
      time: "19:45~",
      title: "í˜¸í…” ë³µê·€ & íœ´ì‹ (ë‚´ì¼ ë””ì¦ˆë‹ˆ ëŒ€ë¹„)",
      tag: "íœ´ì‹",
      transport: "none",
      from: "",
      to: "",
      notes: "ê°€ëŠ¥í•˜ë©´ ì¡°ê¸° ì·¨ì¹¨"
    }
  ],

  "2/16": [
    {
      id: crypto.randomUUID(),
      time: "08:30â€“09:15",
      title: "ë¦¬ì¸ ì¹¼íŠ¼ â†’ ë””ì¦ˆë‹ˆëœë“œ í˜¸í…”(ë¡¯ì§€) ì´ë™",
      tag: "ì´ë™",
      transport: "driving",
      from: "The Ritz-Carlton, Hong Kong",
      to: "Hong Kong Disneyland Hotel",
      notes: "íƒì‹œ ì¶”ì²œ(ì•„ì´+ì§) Â· ì²´í¬ì¸ ì „ ì§ ë³´ê´€"
    },
    {
      id: crypto.randomUUID(),
      time: "09:30â€“11:30",
      title: "ë””ì¦ˆë‹ˆ ì˜¤ì „ ê³¨ë“ íƒ€ì„ (ëŒ€ê¸° ì§§ì„ ë•Œ)",
      tag: "ì–´íŠ¸ë™ì…˜",
      transport: "walking",
      from: "Hong Kong Disneyland Hotel",
      to: "Hong Kong Disneyland Park",
      notes: "ì¶”ì²œ: it's a small world â†’ Pooh â†’ Dumbo(ìƒí™© ë´ì„œ) Â· ìºìŠ¬ ì‚¬ì§„"
    },
    {
      id: crypto.randomUUID(),
      time: "12:00â€“12:40",
      title: "ì ì‹¬ (Main Street/ì‹¤ë‚´ ë ˆìŠ¤í† ë‘)",
      tag: "ì‹ì‚¬",
      transport: "none",
      from: "",
      to: "",
      notes: "ì•„ì´ ì»¨ë””ì…˜ ë³´ê³  ì‹¤ë‚´ ì„ í˜¸"
    },
    {
      id: crypto.randomUUID(),
      time: "13:00â€“15:00",
      title: "í˜¸í…” ë‚®ì /íœ´ì‹ (ì €ë… í¼ë ˆì´ë“œ ì²´ë ¥ í™•ë³´)",
      tag: "ë‚®ì ",
      transport: "walking",
      from: "Hong Kong Disneyland Park",
      to: "Hong Kong Disneyland Hotel",
      notes: "ìœ ëª¨ì°¨/ë„ë³´ ë˜ëŠ” ì…”í‹€"
    },
    {
      id: crypto.randomUUID(),
      time: "15:15â€“16:00",
      title: "Lion King ì‡¼(ì‹¤ë‚´) / ë˜ëŠ” ìºë¦­í„° ë¯¸íŒ…",
      tag: "ì‡¼",
      transport: "walking",
      from: "Hong Kong Disneyland Hotel",
      to: "Hong Kong Disneyland Park",
      notes: "ë‚ ì”¨/ì•„ì´ ì»¨ë””ì…˜ì— ë”°ë¼ ìœ ë™ì ìœ¼ë¡œ"
    },
    {
      id: crypto.randomUUID(),
      time: "16:45â€“17:20",
      title: "Jungle River Cruise / ì‚°ì±…/ê°„ì‹",
      tag: "ì–´íŠ¸ë™ì…˜",
      transport: "none",
      from: "",
      to: "",
      notes: "ëŒ€ê¸° ê¸¸ë©´ í¼ë ˆì´ë“œ ìë¦¬ ì„ ì ìœ¼ë¡œ ì „í™˜"
    },
    {
      id: crypto.randomUUID(),
      time: "18:30â€“19:30",
      title: "ì €ë… (Explorerâ€™s Club Restaurant ë“±)",
      tag: "ì‹ì‚¬",
      transport: "none",
      from: "",
      to: "",
      notes: "ì•¼ê°„ì‡¼/ë¶ˆê½ƒ ì „ ê°„ë‹¨íˆ"
    },
    {
      id: crypto.randomUUID(),
      time: "20:20â€“20:40",
      title: "íŒŒí¬ â†’ í˜¸í…” ë³µê·€ (ë„ë³´/ì…”í‹€)",
      tag: "ì´ë™",
      transport: "walking",
      from: "Hong Kong Disneyland Park",
      to: "Hong Kong Disneyland Hotel",
      notes: "ëë‚˜ë©´ ë°”ë¡œ ìˆ™ì†Œë¡œ"
    }
  ],

  "2/17": [
    {
      id: crypto.randomUUID(),
      time: "09:00â€“09:30",
      title: "ë¦¬ì¡°íŠ¸ ì‚°ì±…/ê¸°ë…ì‚¬ì§„",
      tag: "ì‚°ì±…",
      transport: "none",
      from: "",
      to: "",
      notes: "ì²´í¬ì•„ì›ƒ ì¤€ë¹„"
    },
    {
      id: crypto.randomUUID(),
      time: "10:00â€“10:40",
      title: "ë””ì¦ˆë‹ˆëœë“œ í˜¸í…” â†’ ê³µí•­ ì´ë™",
      tag: "ì´ë™",
      transport: "driving",
      from: "Hong Kong Disneyland Hotel",
      to: "Hong Kong International Airport",
      notes: "ì‹œê°„ ì—¬ìœ  ìˆê²Œ ì¶œë°œ"
    },
    {
      id: crypto.randomUUID(),
      time: "14:40",
      title: "âœˆï¸ ì¶œêµ­",
      tag: "ì¶œêµ­",
      transport: "none",
      from: "",
      to: "",
      notes: "ë©´ì„¸/ì‹ì‚¬/ì•„ì´ íœ´ì‹ ê³ ë ¤"
    }
  ],

  "â˜” ìš°ì²œ": [
    {
      id: crypto.randomUUID(),
      time: "10:00â€“10:40",
      title: "Lion King ì‡¼(ì‹¤ë‚´)",
      tag: "ì‹¤ë‚´",
      transport: "none",
      from: "",
      to: "",
      notes: "ìš°ì²œ ì‹œ ìš°ì„  ì¶”ì²œ"
    },
    {
      id: crypto.randomUUID(),
      time: "10:50â€“11:20",
      title: "it's a small world (ì‹¤ë‚´/ëŒ€ê¸° ì§§ìŒ)",
      tag: "ì‹¤ë‚´",
      transport: "none",
      from: "",
      to: "",
      notes: "ìœ ëª¨ì°¨ OK"
    },
    {
      id: crypto.randomUUID(),
      time: "11:30â€“12:00",
      title: "Animation Academy / ì‹¤ë‚´ ì²´í—˜",
      tag: "ì‹¤ë‚´",
      transport: "none",
      from: "",
      to: "",
      notes: "ì•„ì´ ì»¨ë””ì…˜ ë”°ë¼ ì§§ê²Œ"
    },
    {
      id: crypto.randomUUID(),
      time: "15:15â€“16:00",
      title: "ì‹¤ë‚´ ìºë¦­í„° ë¯¸íŒ…",
      tag: "ì‹¤ë‚´",
      transport: "none",
      from: "",
      to: "",
      notes: "ë¹„ ì˜¬ ë•Œ ë§Œì¡±ë„ ë†’ìŒ"
    }
  ]
};

/** =========================
 *  1) ì €ì¥/ë¡œë“œ
 *  ========================= */
const STORAGE_KEY = "hk_trip_schedule_v2";
function loadData(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(!raw) return structuredClone(DEFAULT_DATA);
  try{ return JSON.parse(raw); }catch{ return structuredClone(DEFAULT_DATA); }
}
function saveData(d){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(d));
}

/** =========================
 *  2) êµ¬ê¸€ë§µ ë§í¬ ìƒì„±
 *  ========================= */
function mapsUrl(item){
  if(!item.from || !item.to) return "";
  const from = encodeURIComponent(item.from);
  const to = encodeURIComponent(item.to);
  if(item.transport === "walking") return `https://www.google.com/maps/dir/${from}/${to}/?travelmode=walking`;
  if(item.transport === "driving") return `https://www.google.com/maps/dir/${from}/${to}/?travelmode=driving`;
  if(item.transport === "transit") return `https://www.google.com/maps/dir/${from}/${to}/?travelmode=transit`;
  return `https://www.google.com/maps/dir/${from}/${to}/`;
}
function labelTransport(t){
  if(t==="walking") return "ë„ë³´";
  if(t==="transit") return "ëŒ€ì¤‘êµí†µ";
  if(t==="driving") return "íƒì‹œ/ì°¨ëŸ‰";
  return "ì—†ìŒ";
}

/** =========================
 *  3) ìƒíƒœ
 *  ========================= */
let data = loadData();
saveData(data); // ìµœì´ˆ ì €ì¥
let activeTab = "2/15";
let editMode = false;

const tabsEl = document.getElementById("tabs");
const contentRoot = document.getElementById("contentRoot");

const editToggle = document.getElementById("editModeToggle");
const addBtn = document.getElementById("addItemBtn");
const resetBtn = document.getElementById("resetBtn");
const exportBtn = document.getElementById("exportBtn");
const importFile = document.getElementById("importFile");

/** =========================
 *  4) ë Œë”ë§
 *  ========================= */
const TAB_ORDER = ["2/15","2/16","2/17","â˜” ìš°ì²œ","ğŸ“Œ í•„ìˆ˜ì •ë³´"];

function renderTabs(){
  tabsEl.innerHTML = TAB_ORDER.map(k=>{
    return `<button class="${k===activeTab?'active':''}" data-tab="${k}">${k}</button>`;
  }).join("");

  tabsEl.querySelectorAll("button").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      activeTab = btn.dataset.tab;
      render();
    });
  });
}


  function applyTheme(){
    // 2/16(ë””ì¦ˆë‹ˆ)ë§Œ ë””ì¦ˆë‹ˆ í…Œë§ˆ ì ìš©, ë‚˜ë¨¸ì§€ëŠ” í™ì½© í…Œë§ˆ
    const theme = (activeTab === '2/16') ? 'disney' : 'hk';
    document.documentElement.setAttribute('data-theme', theme);
  }

function render(){
  applyTheme();
  renderTabs();

  const isInfo = (activeTab === "ğŸ“Œ í•„ìˆ˜ì •ë³´");
  document.getElementById("toolbar").style.display = isInfo ? "none" : "flex";

  if(isInfo){
    contentRoot.innerHTML = renderInfo();
    return;
  }

  const list = data[activeTab] || [];
  contentRoot.innerHTML = list.map(item=>renderCard(item)).join("");

  // í¸ì§‘ ì´ë²¤íŠ¸
  if(editMode){
    contentRoot.querySelectorAll("[data-action]").forEach(el=>{
      el.addEventListener("click", ()=>{
        const action = el.dataset.action;
        const id = el.dataset.id;
        if(action==="save") return onSave(id);
        if(action==="delete") return onDelete(id);
      });
    });
  }
}

function renderCard(item){
  const url = mapsUrl(item);
  const showMap = url && item.transport !== "none";
  const moveLine = (item.transport !== "none")
    ? `êµí†µ: ${labelTransport(item.transport)}${(item.from && item.to) ? ` Â· ${escapeHtml(item.from)} â†’ ${escapeHtml(item.to)}` : ""}`
    : "";

  return `
    <div class="card" data-id="${item.id}">
      <div class="card-header">
        <div style="min-width:0">
          <div class="time">${escapeHtml(item.time || "")}</div>
          <div class="title">${escapeHtml(item.title || "")}</div>
          <div class="meta">
            ${moveLine ? `<div>${moveLine}</div>` : ""}
            ${item.notes ? `<div style="margin-top:6px">${escapeHtml(item.notes)}</div>` : ""}
          </div>
          ${showMap ? `<a class="map-btn" href="${url}" target="_blank" rel="noopener">ì§€ë„ ì—´ê¸°</a>` : ""}
        </div>
        <div class="tag">${escapeHtml(item.tag || "")}</div>
      </div>

      ${editMode ? renderEditForm(item) : ""}
    </div>
  `;
}

function renderEditForm(item){
  return `
    <div class="edit-row">
      <div class="grid2">
        <input placeholder="ì‹œê°„ (ì˜ˆ: 09:00â€“11:30)" value="${escapeAttr(item.time||"")}" data-field="time" data-id="${item.id}">
        <input placeholder="íƒœê·¸ (ì˜ˆ: ì´ë™/ì‹ì‚¬/ì‡¼)" value="${escapeAttr(item.tag||"")}" data-field="tag" data-id="${item.id}">
      </div>

      <input placeholder="ì œëª©" value="${escapeAttr(item.title||"")}" data-field="title" data-id="${item.id}">

      <div class="grid2">
        <select data-field="transport" data-id="${item.id}">
          <option value="none" ${item.transport==="none"?"selected":""}>ì´ë™ ì—†ìŒ</option>
          <option value="walking" ${item.transport==="walking"?"selected":""}>ë„ë³´</option>
          <option value="transit" ${item.transport==="transit"?"selected":""}>ëŒ€ì¤‘êµí†µ(MTR)</option>
          <option value="driving" ${item.transport==="driving"?"selected":""}>íƒì‹œ/ì°¨ëŸ‰</option>
        </select>
        <input placeholder="ì¶œë°œì§€ (ì˜ˆ: Hong Kong Disneyland Hotel)" value="${escapeAttr(item.from||"")}" data-field="from" data-id="${item.id}">
      </div>

      <input placeholder="ë„ì°©ì§€ (ì˜ˆ: Hong Kong Disneyland Park)" value="${escapeAttr(item.to||"")}" data-field="to" data-id="${item.id}">

      <textarea rows="3" placeholder="ë©”ëª¨/ë””í…Œì¼" data-field="notes" data-id="${item.id}">${escapeHtml(item.notes||"")}</textarea>

      <div class="edit-actions">
        <button class="small-btn" data-action="save" data-id="${item.id}">ì €ì¥</button>
        <button class="small-btn danger" data-action="delete" data-id="${item.id}">ì‚­ì œ</button>
      </div>
    </div>
  `;
}

/** =========================
 *  5) í¸ì§‘ ë¡œì§
 *  ========================= */
function onDelete(id){
  data[activeTab] = (data[activeTab]||[]).filter(x=>x.id!==id);
  saveData(data);
  render();
}
function onSave(id){
  const fields = contentRoot.querySelectorAll(`[data-id="${id}"][data-field]`);
  const patch = {};
  fields.forEach(el=>{
    const key = el.dataset.field;
    patch[key] = el.value;
  });

  data[activeTab] = (data[activeTab]||[]).map(item=>{
    if(item.id !== id) return item;
    return {...item, ...patch};
  });

  saveData(data);
  render();
}

/** =========================
 *  6) íˆ´ë°” ì´ë²¤íŠ¸
 *  ========================= */
editToggle.addEventListener("change", ()=>{
  editMode = editToggle.checked;
  addBtn.disabled = !editMode;
  resetBtn.disabled = !editMode;
  render();
});

addBtn.addEventListener("click", ()=>{
  const newItem = {
    id: crypto.randomUUID(),
    time: "",
    title: "",
    tag: "",
    transport: "none",
    from: "",
    to: "",
    notes: ""
  };
  data[activeTab] = [newItem, ...(data[activeTab]||[])];
  saveData(data);
  render();
});

resetBtn.addEventListener("click", ()=>{
  if(!confirm("ì •ë§ ì´ˆê¸°í™”í• ê¹Œìš”? (ì €ì¥ëœ í¸ì§‘ ë‚´ìš©ì´ ì‚¬ë¼ì ¸ìš”)")) return;
  data = structuredClone(DEFAULT_DATA);
  saveData(data);
  render();
});

exportBtn.addEventListener("click", ()=>{
  const blob = new Blob([JSON.stringify(data, null, 2)], {type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "hk-trip-schedule.json";
  a.click();
  URL.revokeObjectURL(a.href);
});

if(importFile) importFile.addEventListener("change", async ()=>{
  const file = importFile.files?.[0];
  if(!file) return;
  const text = await file.text();
  try{
    const obj = JSON.parse(text);
    data = obj;
    saveData(data);
    render();
    alert("ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ!");
  }catch{
    alert("JSON í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•Šì•„ìš”. ë‚´ë³´ë‚´ê¸° íŒŒì¼ì„ ê·¸ëŒ€ë¡œ ê°€ì ¸ì™€ ì£¼ì„¸ìš”.");
  }finally{
    importFile.value = "";
  }
});

/** =========================
 *  7) í•„ìˆ˜ì •ë³´ ë Œë”
 *  ========================= */
function renderInfo() {
  // í•„ìˆ˜ì •ë³´ íƒ­: eSIM/í™˜ì „/ì˜¥í† í¼ìŠ¤/ì‘ê¸‰ + í˜¸í…” ì£¼ë³€ ì¶”ì²œ(êµ¬ê¸€ë§µ ë§í¬)
  const gm = (q) => `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(q)}`;
  const gmd = (from, to, mode='transit') => `https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(from)}&destination=${encodeURIComponent(to)}&travelmode=${mode}`;

  return `
    <div class="info-wrap">
      <div class="info-grid">
        <section class="info-card">
          <h3>ğŸ“Œ ì—¬í–‰ í•„ìˆ˜ ì²´í¬</h3>
          <ul class="info-list">
            <li>
              <b>eSIM / ë°ì´í„°</b><br/>
              <span class="muted">ë¹„í–‰ê¸° ë‚´ë¦¬ë©´ ë¨¼ì € eSIM ì¼œê¸° â†’ ë°ì´í„°/ë¡œë° OFF í™•ì¸ â†’ ì§€ë„/ë©”ì‹ ì € ì •ìƒ ì‘ë™ í™•ì¸.</span>
            </li>
            <li>
              <b>í™˜ì „/í˜„ê¸ˆ</b><br/>
              <span class="muted">ê³µí•­ ATMì—ì„œ <b>ì†Œì•¡ ì¸ì¶œ(HKD)</b>ë¡œ ì‹œì‘(íƒì‹œ/ê°„ì‹/ì˜ˆë¹„). ì´í›„ í•„ìš”í•  ë•Œ ì¶”ê°€ ì¸ì¶œ.</span>
            </li>
            <li>
              <b>ì˜¥í† í¼ìŠ¤(Octopus)</b><br/>
              <span class="muted">ëŒ€ì¤‘êµí†µ/í¸ì˜ì  ê²°ì œì— ìœ ìš©. ì¶©ì „ì€ ì—­/í¸ì˜ì ì—ì„œ ê°€ëŠ¥. (ì¹´ë“œ/í˜„ê¸ˆ ë‘˜ ë‹¤ ë˜ëŠ” ê³³ ë§ìŒ)</span>
            </li>
            <li>
              <b>êµí†µ ê²°ì œ</b><br/>
              <span class="muted">íƒì‹œ/ì°¨ëŸ‰: ì¹´ë“œ ë˜ëŠ” ê²½ìš°ë„ ìˆì§€ë§Œ <b>í˜„ê¸ˆ</b> ì¤€ë¹„í•˜ë©´ í¸í•¨. ì§€í•˜ì² (MTR)ì€ ì˜¥í† í¼ìŠ¤/ë¹„ì ‘ì´‰ ê²°ì œ ê°€ëŠ¥.</span>
            </li>
            <li>
              <b>ì‘ê¸‰/ë³‘ì›</b><br/>
              <span class="muted">ì•„ì´ ì»¨ë””ì…˜ ì•ˆ ì¢‹ìœ¼ë©´ ë¬´ë¦¬ ê¸ˆì§€. ê°€ê¹Œìš´ ë³‘ì›/ì‘ê¸‰ì‹¤ì€ ì•„ë˜ í˜¸í…” ì£¼ë³€ ë¦¬ìŠ¤íŠ¸ì—ì„œ ë°”ë¡œ ê²€ìƒ‰ ê°€ëŠ¥.</span>
            </li>
          </ul>
        </section>

        <section class="info-card">
          <h3>ğŸ’³ ê²°ì œ/ì˜ˆì‚° ë©”ëª¨</h3>
          <ul class="info-list">
            <li><b>ì¹´ë“œ + í˜„ê¸ˆ</b>: ì¹´ë“œ ìœ„ì£¼ + í˜„ê¸ˆì€ êµí†µ/ê°„ì‹/ë¹„ìƒìš©.</li>
            <li><b>íŒ</b>: ë³´í†µ í•„ìˆ˜ ì•„ë‹˜(ê³ ê¸‰ í˜¸í…”/ë ˆìŠ¤í† ë‘ì€ ì„œë¹„ìŠ¤ ì°¨ì§€ í¬í•¨ì´ ë§ìŒ).</li>
            <li><b>ì•„ì´ ë™ì„ </b>: ì´ë™ì€ â€œì§§ê²Œ + ì¤‘ê°„ íœ´ì‹â€ ê¸°ì¤€ìœ¼ë¡œ ê³„íš(ë‚®ì /ê°„ì‹ íƒ€ì„ í™•ë³´).</li>
          </ul>
        </section>

        <section class="info-card">
          <h3>ğŸ¨ 2/15 ìˆ™ì†Œ ì£¼ë³€: The Ritz-Carlton, Hong Kong (ICC)</h3>
          <div class="info-actions">
            <a class="btn small" href="${gm('The Ritz-Carlton, Hong Kong')}">í˜¸í…” ìœ„ì¹˜(êµ¬ê¸€ë§µ)</a>
            <a class="btn small" href="${gm('Elements Mall, Hong Kong')}">Elements ì‡¼í•‘ëª°</a>
            <a class="btn small" href="${gm('Hong Kong Palace Museum')}">HK Palace Museum</a>
            <a class="btn small" href="${gm('West Kowloon Cultural District')}">West Kowloon ì‚°ì±…</a>
            <a class="btn small" href="${gm('hospital near The Ritz-Carlton, Hong Kong')}">ê·¼ì²˜ ë³‘ì› ê²€ìƒ‰</a>
          </div>
          <p class="muted">ë™ì„  íŒ: ICC/ElementsëŠ” ì‹¤ë‚´ ì´ë™ì´ ë§ì•„ì„œ ì•„ì´/ìœ ëª¨ì°¨ì— í¸í•´.</p>
        </section>

        <section class="info-card">
          <h3>ğŸ¨ 2/16 ìˆ™ì†Œ ì£¼ë³€: Hong Kong Disneyland Hotel / Disney Explorers Lodge</h3>
          <div class="info-actions">
            <a class="btn small" href="${gm('Hong Kong Disneyland Hotel')}">ë””ì¦ˆë‹ˆëœë“œ í˜¸í…”</a>
            <a class="btn small" href="${gm('Disney Explorers Lodge')}">Explorers Lodge</a>
            <a class="btn small" href="${gm('Inspiration Lake, Hong Kong Disneyland Resort')}">Inspiration Lake</a>
            <a class="btn small" href="${gm('Citygate Outlets')}">Citygate Outlets</a>
            <a class="btn small" href="${gm('hospital near Hong Kong Disneyland')}">ê·¼ì²˜ ë³‘ì› ê²€ìƒ‰</a>
          </div>
          <p class="muted">2/16ì€ ë””ì¦ˆë‹ˆ ì˜¬ì¸ì´ë¼ë©´, í˜¸í…”ì€ ì‹¤ì œ ì˜ˆì•½í•œ í•œ ê³³ ê¸°ì¤€ìœ¼ë¡œë§Œ ë³´ê²Œ í•´ë„ OK.</p>
        </section>

        <section class="info-card">
          <h3>ğŸ—ºï¸ ë¹ ë¥¸ ê¸¸ì°¾ê¸°</h3>
          <div class="info-actions">
            <a class="btn small" href="${gmd('Hong Kong International Airport', 'The Ritz-Carlton, Hong Kong', 'driving')}">ê³µí•­ â†’ ë¦¬ì¸ ì¹¼íŠ¼</a>
            <a class="btn small" href="${gmd('The Ritz-Carlton, Hong Kong', 'Hong Kong Disneyland Hotel', 'transit')}">ë¦¬ì¸ ì¹¼íŠ¼ â†’ ë””ì¦ˆë‹ˆ í˜¸í…”</a>
            <a class="btn small" href="${gmd('Hong Kong Disneyland Hotel', 'Hong Kong International Airport', 'driving')}">ë””ì¦ˆë‹ˆ â†’ ê³µí•­</a>
          </div>
          <p class="muted">â€» ê¸¸ì°¾ê¸°ëŠ” êµí†µìƒí™©/ì‹œê°„ëŒ€ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´. ì¶œë°œ ì§ì „ì— í•œ ë²ˆë§Œ í™•ì¸í•˜ë©´ ë¼.</p>
        </section>
      </div>
    </div>
  `;
}

/** =========================
 *  8) XSS ì•ˆì „ ì¶œë ¥
 *  ========================= */
function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, s => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
  }[s]));
}
function escapeAttr(str){
  return escapeHtml(str).replace(/\n/g," ");
}

/** ìµœì´ˆ ë Œë” */
render();



/* ===== Weather (Open-Meteo, no API key) ===== */
(function(){
  const HK = { name: "í™ì½©", lat: 22.3193, lon: 114.1694, tz: "Asia/Hong_Kong" };

  function pad2(n){ return String(n).padStart(2,'0'); }
  function tripYearFor(month, day){
    const now = new Date();
    const y = now.getFullYear();
    const tripThisYearEnd = new Date(y, month-1, day, 23, 59, 59);
    // ì˜¤ëŠ˜ì´ ì—¬í–‰ì¼ ì´í›„ë©´ ë‹¤ìŒ í•´ë¡œ
    return (now > tripThisYearEnd) ? (y+1) : y;
  }

  function codeToEmoji(code){
    // Open-Meteo weathercode (WMO) â†’ emoji
    if (code === 0) return "â˜€ï¸";
    if ([1,2].includes(code)) return "ğŸŒ¤ï¸";
    if (code === 3) return "â˜ï¸";
    if ([45,48].includes(code)) return "ğŸŒ«ï¸";
    if ([51,53,55,56,57].includes(code)) return "ğŸŒ¦ï¸";
    if ([61,63,65,66,67].includes(code)) return "ğŸŒ§ï¸";
    if ([71,73,75,77].includes(code)) return "ğŸŒ¨ï¸";
    if ([80,81,82].includes(code)) return "ğŸŒ§ï¸";
    if ([85,86].includes(code)) return "ğŸŒ¨ï¸";
    if ([95,96,99].includes(code)) return "â›ˆï¸";
    return "ğŸŒ¡ï¸";
  }

  async function loadHeaderWeather(){
    const el = document.getElementById("headerWeather");
    if (!el) return;

    const year = tripYearFor(2, 17);
    const start = `${year}-02-15`;
    const end   = `${year}-02-17`;

    const url = new URL("https://api.open-meteo.com/v1/forecast");
    url.searchParams.set("latitude", HK.lat);
    url.searchParams.set("longitude", HK.lon);
    url.searchParams.set("timezone", HK.tz);
    url.searchParams.set("current_weather", "true");
    url.searchParams.set("daily", "temperature_2m_max,temperature_2m_min,precipitation_probability_max,weathercode");
    url.searchParams.set("start_date", start);
    url.searchParams.set("end_date", end);

    try{
      const res = await fetch(url.toString(), { cache: "no-store" });
      if(!res.ok) throw new Error("weather fetch failed");
      const data = await res.json();

      const curT = data?.current_weather?.temperature;
      const curCode = data?.current_weather?.weathercode;
      const curEmoji = codeToEmoji(curCode);

      // daily arrays
      const times = data?.daily?.time || [];
      const tmax  = data?.daily?.temperature_2m_max || [];
      const tmin  = data?.daily?.temperature_2m_min || [];
      const pop   = data?.daily?.precipitation_probability_max || [];
      const wcode = data?.daily?.weathercode || [];

      const dailyRows = times.map((iso, i) => {
        const d = new Date(iso + "T00:00:00");
        const mm = pad2(d.getMonth()+1);
        const dd = pad2(d.getDate());
        const emoji = codeToEmoji(wcode[i]);
        const range = `${Math.round(tmin[i])}â€“${Math.round(tmax[i])}Â°C`;
        const p = (pop[i] ?? null);
        const pText = (p === null || Number.isNaN(p)) ? "" : `ë¹„í™•ë¥  ${Math.round(p)}%`;
        return `<div class="row"><div class="date">${mm}/${dd}</div><div class="range">${emoji} ${range}</div><div class="pop">${pText}</div></div>`;
      }).join("");

      const curLine = (curT === undefined || curT === null)
        ? `<div class="current"><span>ğŸŒ¡ï¸</span><span class="temp">ë‚ ì”¨ ë¡œë”©</span></div>`
        : `<div class="current"><span>${curEmoji}</span><span class="temp">${Math.round(curT)}Â°C</span><span class="loc">(${HK.name})</span></div>`;

      el.innerHTML = `${curLine}<div class="daily">${dailyRows}</div>`;
    }catch(err){
      // ì¡°ìš©íˆ ì‹¤íŒ¨ í‘œì‹œ
      el.innerHTML = `<div class="current"><span>ğŸŒ¡ï¸</span><span class="temp">ë‚ ì”¨ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨</span></div>`;
    }
  }

  window.addEventListener("load", loadHeaderWeather);
})();

</script>
</body>
</html>
// Google Maps: ê²€ìƒ‰ ë§í¬ ìƒì„± (API key ë¶ˆí•„ìš”)
const gmSearch = (q) => `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(q)}`;


<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>í™ì½© ê°€ì¡±ì—¬í–‰</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", sans-serif;
  background: #f5f6f8;
}
header {
  background: #111;
  color: #fff;
  padding: 14px;
  text-align: center;
  font-weight: 700;
}
.tabs {
  display: flex;
  background: #fff;
  border-bottom: 1px solid #ddd;
}
.tabs button {
  flex: 1;
  padding: 12px;
  border: none;
  background: none;
  font-size: 14px;
}
.tabs button.active {
  border-bottom: 3px solid #111;
  font-weight: bold;
}
.section {
  display: none;
  padding: 14px;
}
.section.active {
  display: block;
}
.card {
  background: #fff;
  border-radius: 12px;
  padding: 12px;
  margin-bottom: 10px;
}
.time {
  font-weight: bold;
  margin-bottom: 6px;
}
.tag {
  font-size: 12px;
  color: #666;
  margin-bottom: 6px;
}

.weather-card .weather-meta{
  margin-top:6px;
  line-height:1.35;
  color:#222;
  font-size:14px;
}
.weather-card .weather-small{
  color:#555;
  font-size:12px;
  margin-top:6px;
}

</style>
</head>

<body>

<header>ğŸ‡­ğŸ‡° í™ì½© ê°€ì¡±ì—¬í–‰ ì›¹ì•±</header>

<div class="tabs">
  <button class="active" onclick="show(0)">2/15</button>
  <button onclick="show(1)">2/16</button>
  <button onclick="show(2)">â˜” ìš°ì²œ</button>
  <button onclick="show(3)">2/17</button>
</div>

<!-- 2/15 -->
<div class="section active">
  <div class="card"><div class="time">14:30â€“15:30</div><div class="tag">ğŸš• ì´ë™</div>ê³µí•­ â†’ ë¦¬ì¸ ì¹¼íŠ¼ í™ì½©</div>
  <div class="card"><div class="time">15:30â€“16:45</div><div class="tag">ğŸ˜´ ë‚®ì </div>í˜¸í…” ê°ì‹¤</div>
  <div class="card"><div class="time">17:00â€“18:00</div><div class="tag">ğŸœ ì‹ì‚¬</div>Makâ€™s Noodle</div>
  <div class="card"><div class="time">19:45â€“20:30</div><div class="tag">ğŸ½ ì €ë…</div>Crystal Jade</div>
</div>

<!-- 2/16 ì •ìƒ -->
<div class="section">
  <div class="card"><div class="time">10:00â€“10:25</div><div class="tag">ğŸ </div>itâ€™s a small world</div>
  <div class="card"><div class="time">10:35â€“11:00</div><div class="tag">ğŸ </div>Winnie the Pooh</div>
  <div class="card"><div class="time">11:10â€“11:30</div><div class="tag">ğŸ“¸</div>ìºë¦­í„° ë¯¸íŒ…</div>
  <div class="card"><div class="time">12:00â€“12:30</div><div class="tag">ğŸ½</div>ì ì‹¬ (Main Street)</div>
  <div class="card"><div class="time">12:30â€“15:00</div><div class="tag">ğŸ˜´ ë‚®ì </div>í˜¸í…” ê°ì‹¤</div>
  <div class="card"><div class="time">15:15â€“15:45</div><div class="tag">ğŸ­</div>Lion King ì‡¼</div>
  <div class="card"><div class="time">16:45â€“17:20</div><div class="tag">ğŸš¤</div>Jungle River Cruise</div>
</div>

<!-- ìš°ì²œ -->
<div class="section">
  <div class="card"><div class="time">10:00â€“10:40</div>Lion King ì‡¼</div>
  <div class="card"><div class="time">10:50â€“11:20</div>itâ€™s a small world</div>
  <div class="card"><div class="time">11:30â€“12:00</div>Animation Academy</div>
  <div class="card"><div class="time">15:15â€“16:00</div>ì‹¤ë‚´ ìºë¦­í„° ë¯¸íŒ…</div>
</div>

<!-- 2/17 -->
<div class="section">
  <div class="card"><div class="time">09:00â€“09:30</div>ë¦¬ì¡°íŠ¸ ì‚°ì±…</div>
  <div class="card"><div class="time">10:00â€“10:40</div>ğŸš• ë””ì¦ˆë‹ˆ â†’ ê³µí•­</div>
  <div class="card"><div class="time">14:40</div>âœˆï¸ í•˜ë…¸ì´ ì¶œë°œ</div>
</div>

<script>
function show(i){
  document.querySelectorAll('.tabs button').forEach((b,idx)=>b.classList.toggle('active',idx===i));
  document.querySelectorAll('.section').forEach((s,idx)=>s.classList.toggle('active',idx===i));
  loadWeather(i);
}

const WEATHER_LOCATIONS = [
  { name: "ì¹¨ì‚¬ì¶”ì´/ë¦¬ì¸ ì¹¼íŠ¼(ICC)", lat: 22.3034, lon: 114.1601 }, // ICC ìª½
  { name: "í™ì½© ë””ì¦ˆë‹ˆëœë“œ", lat: 22.3129, lon: 114.0413 },
  { name: "ìš°ì²œ ëŒ€ì•ˆ(ì¹¨ì‚¬ì¶”ì´ ì¤‘ì‹¬)", lat: 22.2969, lon: 114.1722 },
  { name: "í™ì½©(ì„¼íŠ¸ëŸ´)", lat: 22.2819, lon: 114.1582 }
];

function wcText(code){
  const map = {
    0:"ë§‘ìŒ",1:"ëŒ€ì²´ë¡œ ë§‘ìŒ",2:"ë¶€ë¶„ì ìœ¼ë¡œ íë¦¼",3:"íë¦¼",
    45:"ì•ˆê°œ",48:"ì„œë¦¬ ì•ˆê°œ",
    51:"ì´ìŠ¬ë¹„(ì•½)",53:"ì´ìŠ¬ë¹„(ë³´í†µ)",55:"ì´ìŠ¬ë¹„(ê°•)",
    61:"ë¹„(ì•½)",63:"ë¹„(ë³´í†µ)",65:"ë¹„(ê°•)",
    71:"ëˆˆ(ì•½)",73:"ëˆˆ(ë³´í†µ)",75:"ëˆˆ(ê°•)",
    80:"ì†Œë‚˜ê¸°(ì•½)",81:"ì†Œë‚˜ê¸°(ë³´í†µ)",82:"ì†Œë‚˜ê¸°(ê°•)",
    95:"ë‡Œìš°",96:"ë‡Œìš°(ìš°ë°• ê°€ëŠ¥)",99:"ë‡Œìš°(ê°•/ìš°ë°•)"
  };
  return map[code] ?? `ë‚ ì”¨ì½”ë“œ ${code}`;
}

async function loadWeather(i){
  const el = document.querySelector(`#weather-card-${i} .weather-meta`);
  if(!el) return;
  el.textContent = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦";

  const loc = WEATHER_LOCATIONS[i] ?? WEATHER_LOCATIONS[0];
  const url =
    `https://api.open-meteo.com/v1/forecast?latitude=${loc.lat}&longitude=${loc.lon}` +
    `&current=temperature_2m,apparent_temperature,precipitation,weather_code,wind_speed_10m` +
    `&hourly=precipitation_probability&forecast_days=1&timezone=Asia%2FHong_Kong`;

  try{
    const r = await fetch(url, { cache: "no-store" });
    if(!r.ok) throw new Error("HTTP " + r.status);
    const data = await r.json();

    const c = data.current;
    const temp = c.temperature_2m;
    const feels = c.apparent_temperature;
    const wind = c.wind_speed_10m;
    const pr = c.precipitation;
    const desc = wcText(c.weather_code);

    // í˜„ì¬ì‹œê°„ì— ê°€ì¥ ê°€ê¹Œìš´ ê°•ìˆ˜í™•ë¥ (ì‹œê°„ëŒ€)
    let pop = null;
    if(data.hourly && data.hourly.time && data.hourly.precipitation_probability){
      const now = new Date(data.current.time).getTime();
      let bestIdx = 0, bestDiff = Infinity;
      data.hourly.time.forEach((t, idx)=>{
        const diff = Math.abs(new Date(t).getTime() - now);
        if(diff < bestDiff){ bestDiff = diff; bestIdx = idx; }
      });
      pop = data.hourly.precipitation_probability[bestIdx];
    }

    el.innerHTML =
      `<b>${loc.name}</b><br>` +
      `${desc} Â· ${temp}Â°C (ì²´ê° ${feels}Â°C)<br>` +
      `ê°•ìˆ˜ ${pr}mm` + (pop!==null ? ` Â· ê°•ìˆ˜í™•ë¥  ${pop}%` : "") + `<br>` +
      `ë°”ëŒ ${wind}km/h` +
      `<div class="weather-small">ì—…ë°ì´íŠ¸: ${new Date(data.current.time).toLocaleString("ko-KR",{timeZone:"Asia/Hong_Kong"})} (í™ì½©ì‹œê°„)</div>`;
  }catch(e){
    el.innerHTML =
      `ë‚ ì”¨ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì–´ ğŸ˜¢<br>` +
      `<span class="weather-small">ë°°í¬ëœ Netlify ì£¼ì†Œ(https)ì—ì„œ ë‹¤ì‹œ í™•ì¸í•´ì¤˜. (file:/// ë¡œ ì—´ë©´ ë¸Œë¼ìš°ì €ê°€ ë§‰ì„ ìˆ˜ ìˆì–´)</span>`;
  }
}

// ì²« í™”ë©´(2/15) ìë™ ë¡œë“œ
window.addEventListener("DOMContentLoaded", ()=>loadWeather(0));

</script>

</body>
</html>
